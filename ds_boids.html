<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çº§å¤šç¾¤ä½“ç²’å­æ¨¡æ‹Ÿç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        header {
            text-align: center;
            margin-bottom: 25px;
            width: 100%;
            max-width: 1600px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7, #dda0dd);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
            max-width: 1000px;
            margin: 0 auto 20px;
            line-height: 1.5;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            width: 100%;
            max-width: 1600px;
            justify-content: center;
        }
        
        .canvas-container {
            flex: 1;
            min-width: 800px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            background-color: #0f172a;
            position: relative;
        }
        
        #simulationCanvas {
            display: block;
            background-color: #0a0a0a;
        }
        
        .controls-container {
            display: flex;
            flex-direction: column;
            width: 750px;
            gap: 25px;
        }
        
        .panel {
            background-color: rgba(30, 41, 59, 0.9);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid #334155;
        }
        
        .panel h2 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #cbd5e1;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #475569;
        }
        
        .panel h2 i {
            font-size: 1.2rem;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group h3 {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #94a3b8;
        }
        
        .param-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            color: #cbd5e1;
            min-width: 150px;
        }
        
        .color-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .color-red { background-color: #ff6b6b; }
        .color-green { background-color: #4ecdc4; }
        .color-blue { background-color: #45b7d1; }
        .color-yellow { background-color: #ffeaa7; }
        .color-purple { background-color: #dda0dd; }
        .color-cyan { background-color: #96ceb4; }
        
        input[type="range"] {
            width: 200px;
            height: 6px;
            border-radius: 3px;
            background: #475569;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #60a5fa;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }
        
        .value-display {
            min-width: 50px;
            text-align: center;
            font-weight: 600;
            color: #60a5fa;
            background-color: rgba(30, 41, 59, 0.8);
            padding: 4px 10px;
            border-radius: 4px;
            border: 1px solid #475569;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
        }
        
        #resetBtn {
            background-color: #475569;
            color: #f1f5f9;
        }
        
        #resetBtn:hover {
            background-color: #64748b;
            transform: translateY(-2px);
        }
        
        #randomizeBtn {
            background: linear-gradient(90deg, #ff6b6b, #45b7d1);
            color: white;
        }
        
        #randomizeBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }
        
        #textFormBtn {
            background: linear-gradient(90deg, #4ecdc4, #dda0dd);
            color: white;
        }
        
        #textFormBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(221, 160, 221, 0.4);
        }
        
        #toggleSlimeBtn {
            background: linear-gradient(90deg, #ffeaa7, #96ceb4);
            color: #1a1a2e;
        }
        
        #toggleSlimeBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(150, 206, 180, 0.4);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 25px;
        }
        
        .stat-item {
            background-color: rgba(30, 41, 59, 0.8);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid #334155;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .text-input-container {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        #textInput {
            flex: 1;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #475569;
            background-color: rgba(30, 41, 59, 0.8);
            color: #f1f5f9;
            font-size: 1rem;
            outline: none;
        }
        
        #textInput:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
        }
        
        .mouse-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .mouse-mode {
            flex: 1;
            padding: 10px;
            background-color: rgba(30, 41, 59, 0.8);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            border: 1px solid #475569;
            transition: all 0.2s ease;
        }
        
        .mouse-mode.active {
            border-color: #60a5fa;
            background-color: rgba(96, 165, 250, 0.2);
        }
        
        .mouse-mode:hover:not(.active) {
            background-color: rgba(71, 85, 105, 0.8);
        }
        
        .footer-info {
            margin-top: 30px;
            text-align: center;
            color: #64748b;
            font-size: 0.9rem;
            padding-bottom: 20px;
            max-width: 1600px;
            line-height: 1.6;
        }
        
        .info-box {
            background-color: rgba(30, 41, 59, 0.8);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #334155;
        }
        
        .info-box h4 {
            color: #cbd5e1;
            margin-bottom: 10px;
        }
        
        .info-box p {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        @media (max-width: 1600px) {
            .container {
                flex-direction: column;
                align-items: center;
            }
            
            .canvas-container, .controls-container {
                width: 100%;
                max-width: 1200px;
            }
            
            .canvas-container {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>é«˜çº§å¤šç¾¤ä½“ç²’å­æ¨¡æ‹Ÿç³»ç»Ÿ</h1>
        <p class="subtitle">å…­ç¾¤ä½“ç»†èŒæ¨¡æ‹Ÿ | å¢æ®–æ­»äº¡æœºåˆ¶ | é»èŒè¡Œä¸ºæ¨¡æ‹Ÿ | é¼ æ ‡å¹²æ¶‰ | æ–‡å­—æˆå‹</p>
    </header>
    
    <div class="container">
        <div class="canvas-container">
            <canvas id="simulationCanvas" width="1000" height="700"></canvas>
            <div class="info-box" style="position: absolute; bottom: 20px; left: 20px; width: 300px;">
                <h4>é¼ æ ‡æ§åˆ¶æ¨¡å¼</h4>
                <p>å½“å‰æ¨¡å¼: <span id="currentMouseMode">å¸å¼•</span></p>
                <p>â€¢ å¸å¼•: ç²’å­è¢«é¼ æ ‡å¸å¼•</p>
                <p>â€¢ æ’æ–¥: ç²’å­è¢«é¼ æ ‡æ’æ–¥</p>
                <p>â€¢ é£Ÿç‰©: é¼ æ ‡ä½œä¸ºé£Ÿç‰©æº</p>
                <p>â€¢ æ¸…é™¤: é¼ æ ‡é™„è¿‘ç²’å­æ­»äº¡</p>
            </div>
        </div>
        
        <div class="controls-container">
            <div class="panel">
                <h2><i>âš™ï¸</i> å…¨å±€æ§åˆ¶</h2>
                <div class="control-group">
                    <h3>ç²’å­æ€»æ•°æ§åˆ¶</h3>
                    <div class="param-row">
                        <label><span class="color-dot color-red"></span> çº¢è‰²ç¾¤ä½“</label>
                        <input type="range" id="redCount" min="10" max="200" value="50">
                        <span class="value-display" id="redCountValue">50</span>
                    </div>
                    <div class="param-row">
                        <label><span class="color-dot color-green"></span> ç»¿è‰²ç¾¤ä½“</label>
                        <input type="range" id="greenCount" min="10" max="200" value="50">
                        <span class="value-display" id="greenCountValue">50</span>
                    </div>
                    <div class="param-row">
                        <label><span class="color-dot color-blue"></span> è“è‰²ç¾¤ä½“</label>
                        <input type="range" id="blueCount" min="10" max="200" value="50">
                        <span class="value-display" id="blueCountValue">50</span>
                    </div>
                    <div class="param-row">
                        <label><span class="color-dot color-yellow"></span> é»„è‰²ç¾¤ä½“</label>
                        <input type="range" id="yellowCount" min="10" max="200" value="50">
                        <span class="value-display" id="yellowCountValue">50</span>
                    </div>
                    <div class="param-row">
                        <label><span class="color-dot color-purple"></span> ç´«è‰²ç¾¤ä½“</label>
                        <input type="range" id="purpleCount" min="10" max="200" value="50">
                        <span class="value-display" id="purpleCountValue">50</span>
                    </div>
                    <div class="param-row">
                        <label><span class="color-dot color-cyan"></span> é’è‰²ç¾¤ä½“</label>
                        <input type="range" id="cyanCount" min="10" max="200" value="50">
                        <span class="value-display" id="cyanCountValue">50</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>å…¨å±€å‚æ•°</h3>
                    <div class="param-row">
                        <label>æœ€å¤§é€Ÿåº¦</label>
                        <input type="range" id="maxSpeed" min="1" max="10" step="0.5" value="4">
                        <span class="value-display" id="maxSpeedValue">4.0</span>
                    </div>
                    <div class="param-row">
                        <label>æ„ŸçŸ¥èŒƒå›´</label>
                        <input type="range" id="perceptionRadius" min="20" max="150" value="80">
                        <span class="value-display" id="perceptionRadiusValue">80</span>
                    </div>
                    <div class="param-row">
                        <label>è¾¹ç•Œåå¼¹</label>
                        <input type="range" id="boundaryBounce" min="0" max="1" step="0.1" value="0.8">
                        <span class="value-display" id="boundaryBounceValue">0.8</span>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h2><i>ğŸ¦ </i> ç»†èŒè¡Œä¸ºæ¨¡æ‹Ÿ</h2>
                <div class="control-group">
                    <h3>å¢æ®–ä¸æ­»äº¡</h3>
                    <div class="param-row">
                        <label>åˆ†è£‚æ¦‚ç‡ (%)</label>
                        <input type="range" id="splitChance" min="0" max="5" step="0.1" value="0.5">
                        <span class="value-display" id="splitChanceValue">0.5%</span>
                    </div>
                    <div class="param-row">
                        <label>æ­»äº¡æ¦‚ç‡ (%)</label>
                        <input type="range" id="deathChance" min="0" max="5" step="0.1" value="0.2">
                        <span class="value-display" id="deathChanceValue">0.2%</span>
                    </div>
                    <div class="param-row">
                        <label>æœ€å¤§å¯¿å‘½</label>
                        <input type="range" id="maxLifespan" min="100" max="2000" step="50" value="800">
                        <span class="value-display" id="maxLifespanValue">800</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>é»èŒæ¨¡æ‹Ÿ</h3>
                    <div class="param-row">
                        <label>é»èŒæ¨¡å¼</label>
                        <input type="range" id="slimeMode" min="0" max="100" value="0">
                        <span class="value-display" id="slimeModeValue">0%</span>
                    </div>
                    <div class="param-row">
                        <label>è¿æ¥è·ç¦»</label>
                        <input type="range" id="connectionDistance" min="10" max="100" value="40">
                        <span class="value-display" id="connectionDistanceValue">40</span>
                    </div>
                    <div class="param-row">
                        <label>è¿æ¥å¼ºåº¦</label>
                        <input type="range" id="connectionStrength" min="0" max="1" step="0.1" value="0.3">
                        <span class="value-display" id="connectionStrengthValue">0.3</span>
                    </div>
                </div>
                
                <div class="buttons">
                    <button id="toggleSlimeBtn">åˆ‡æ¢é»èŒæ¨¡å¼</button>
                    <button id="resetBtn">é‡ç½®æ¨¡æ‹Ÿ</button>
                    <button id="randomizeBtn">éšæœºå‚æ•°</button>
                </div>
            </div>
            
            <div class="panel">
                <h2><i>ğŸ–±ï¸</i> é¼ æ ‡æ§åˆ¶ä¸æ–‡å­—æˆå‹</h2>
                <div class="control-group">
                    <h3>é¼ æ ‡äº¤äº’</h3>
                    <div class="mouse-controls">
                        <div class="mouse-mode active" data-mode="attract">
                            <div>å¸å¼•</div>
                            <small>ç²’å­è¢«é¼ æ ‡å¸å¼•</small>
                        </div>
                        <div class="mouse-mode" data-mode="repel">
                            <div>æ’æ–¥</div>
                            <small>ç²’å­è¢«é¼ æ ‡æ’æ–¥</small>
                        </div>
                        <div class="mouse-mode" data-mode="food">
                            <div>é£Ÿç‰©</div>
                            <small>é¼ æ ‡ä½œä¸ºé£Ÿç‰©æº</small>
                        </div>
                        <div class="mouse-mode" data-mode="kill">
                            <div>æ¸…é™¤</div>
                            <small>é¼ æ ‡é™„è¿‘ç²’å­æ­»äº¡</small>
                        </div>
                    </div>
                    
                    <div class="param-row" style="margin-top: 15px;">
                        <label>é¼ æ ‡å½±å“åŠå¾„</label>
                        <input type="range" id="mouseRadius" min="20" max="200" value="100">
                        <span class="value-display" id="mouseRadiusValue">100</span>
                    </div>
                    <div class="param-row">
                        <label>é¼ æ ‡å½±å“å¼ºåº¦</label>
                        <input type="range" id="mouseStrength" min="0.1" max="5" step="0.1" value="2">
                        <span class="value-display" id="mouseStrengthValue">2.0</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>æ–‡å­—æˆå‹</h3>
                    <div class="text-input-container">
                        <input type="text" id="textInput" placeholder="è¾“å…¥è¦æˆå‹çš„æ–‡å­— (ä¾‹å¦‚: Boids)" value="Boids">
                        <button id="textFormBtn">åº”ç”¨æ–‡å­—</button>
                    </div>
                    <div class="param-row" style="margin-top: 15px;">
                        <label>æ–‡å­—å¸å¼•åŠ›</label>
                        <input type="range" id="textAttraction" min="0" max="2" step="0.1" value="0.8">
                        <span class="value-display" id="textAttractionValue">0.8</span>
                    </div>
                    <div class="param-row">
                        <label>æ–‡å­—ä¿æŒåŠ›</label>
                        <input type="range" id="textRetention" min="0" max="1" step="0.1" value="0.5">
                        <span class="value-display" id="textRetentionValue">0.5</span>
                    </div>
                </div>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalParticles">300</div>
                    <div class="stat-label">æ€»ç²’å­æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="fpsCounter">60</div>
                    <div class="stat-label">FPS</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="connectionsCount">0</div>
                    <div class="stat-label">é»èŒè¿æ¥</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="splitCount">0</div>
                    <div class="stat-label">åˆ†è£‚æ¬¡æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="deathCount">0</div>
                    <div class="stat-label">æ­»äº¡æ¬¡æ•°</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="slimeActive">å…³</div>
                    <div class="stat-label">é»èŒæ¨¡å¼</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer-info">
        <p>é«˜çº§å¤šç¾¤ä½“ç²’å­æ¨¡æ‹Ÿç³»ç»Ÿ | å…­ç¾¤ä½“ç»†èŒè¡Œä¸º | é»èŒç½‘ç»œæ¨¡æ‹Ÿ | é¼ æ ‡äº¤äº’æ§åˆ¶ | ç²’å­æ–‡å­—æˆå‹</p>
        <div class="info-box">
            <h4>ç³»ç»Ÿè¯´æ˜</h4>
            <p>1. <strong>å…­ç¾¤ä½“æ¨¡æ‹Ÿ</strong>: å…­ç§é¢œè‰²ç²’å­ç¾¤ä½“ï¼Œæ¯ç»„ç‹¬ç«‹æ§åˆ¶æ•°é‡å’Œè¡Œä¸º</p>
            <p>2. <strong>ç»†èŒè¡Œä¸º</strong>: ç²’å­ä¼šåˆ†è£‚(å¢æ®–)å’Œæ­»äº¡ï¼Œæ¨¡æ‹Ÿå¾®ç”Ÿç‰©ç¾¤ä½“</p>
            <p>3. <strong>é»èŒæ¨¡æ‹Ÿ</strong>: å¼€å¯åç²’å­ä¼šå½¢æˆç½‘ç»œè¿æ¥ï¼Œæ¨¡æ‹Ÿé»èŒè§…é£Ÿè¡Œä¸º</p>
            <p>4. <strong>é¼ æ ‡æ§åˆ¶</strong>: å››ç§é¼ æ ‡æ¨¡å¼å¸å¼•ã€æ’æ–¥ã€é£Ÿç‰©ã€æ¸…é™¤</p>
            <p>5. <strong>æ–‡å­—æˆå‹</strong>: ç²’å­å¯ä»¥èšé›†æˆè¾“å…¥çš„æ–‡å­—å½¢çŠ¶</p>
        </div>
    </div>

    <script>
        // è·å–Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('simulationCanvas');
        const ctx = canvas.getContext('2d');

        // ç²’å­ç±»
        class Particle {
            constructor(x, y, colorType) {
                this.position = { x, y };
                this.velocity = {
                    x: (Math.random() - 0.5) * 4,
                    y: (Math.random() - 0.5) * 4
                };
                this.acceleration = { x: 0, y: 0 };
                this.colorType = colorType; // 0-5 å¯¹åº”å…­ç§é¢œè‰²
                this.radius = 3;
                this.maxSpeed = parseFloat(document.getElementById('maxSpeed').value);
                this.perceptionRadius = parseFloat(document.getElementById('perceptionRadius').value);
                this.lifespan = Math.random() * parseFloat(document.getElementById('maxLifespan').value);
                this.maxLifespan = parseFloat(document.getElementById('maxLifespan').value);
                this.age = 0;
                this.health = 1.0;
                
                // æ ¹æ®é¢œè‰²ç±»å‹è®¾ç½®é¢œè‰²
                this.setColor();
                
                // è¡Œä¸ºå‚æ•°
                this.cohesionFactor = 0.7 + Math.random() * 0.3;
                this.separationFactor = 1.0 + Math.random() * 0.5;
                this.minDistance = 15 + Math.random() * 10;
                this.repulsionFactor = 1.2 + Math.random() * 0.6;
                
                // æ–‡å­—æˆå‹ç›®æ ‡ä½ç½®
                this.textTarget = null;
                
                // é»èŒè¿æ¥
                this.connections = [];
            }
            
            // è®¾ç½®é¢œè‰²
            setColor() {
                const colors = [
                    { fill: '#ff6b6b', stroke: '#ff4757' }, // çº¢
                    { fill: '#4ecdc4', stroke: '#1dd1a1' }, // ç»¿
                    { fill: '#45b7d1', stroke: '#2e86de' }, // è“
                    { fill: '#ffeaa7', stroke: '#fdcb6e' }, // é»„
                    { fill: '#dda0dd', stroke: '#a29bfe' }, // ç´«
                    { fill: '#96ceb4', stroke: '#55efc4' }  // é’
                ];
                
                this.color = colors[this.colorType % colors.length];
            }
            
            // æ›´æ–°å‚æ•°
            updateParameters() {
                this.maxSpeed = parseFloat(document.getElementById('maxSpeed').value);
                this.perceptionRadius = parseFloat(document.getElementById('perceptionRadius').value);
                this.maxLifespan = parseFloat(document.getElementById('maxLifespan').value);
            }
            
            // è®¡ç®—ä¸å…¶ä»–ç²’å­çš„ç›¸äº’ä½œç”¨
            flock(particles) {
                let cohesion = { x: 0, y: 0 };
                let separation = { x: 0, y: 0 };
                let totalSameColor = 0;
                let totalDifferentColor = 0;
                
                // é‡ç½®è¿æ¥
                this.connections = [];
                
                for (let other of particles) {
                    if (other === this) continue;
                    
                    // è®¡ç®—è·ç¦»
                    let dx = this.position.x - other.position.x;
                    let dy = this.position.y - other.position.y;
                    let distance = Math.sqrt(dx * dx + dy * dy);
                    
                    // å¦‚æœåœ¨æ„ŸçŸ¥èŒƒå›´å†…
                    if (distance > 0 && distance < this.perceptionRadius) {
                        // ç›¸åŒé¢œè‰²çš„ç²’å­
                        if (this.colorType === other.colorType) {
                            // å¸å¼•ï¼šè®¡ç®—å¹³å‡ä½ç½®
                            cohesion.x += other.position.x;
                            cohesion.y += other.position.y;
                            totalSameColor++;
                            
                            // åˆ†ç¦»ï¼šå¦‚æœè·ç¦»å°äºæœ€å°è·ç¦»ï¼Œåˆ™æ¨å¼€
                            if (distance < this.minDistance) {
                                separation.x += dx / distance;
                                separation.y += dy / distance;
                            }
                            
                            // é»èŒè¿æ¥ï¼šå¦‚æœè·ç¦»å°äºè¿æ¥è·ç¦»ä¸”é»èŒæ¨¡å¼å¼€å¯
                            if (distance < parseFloat(document.getElementById('connectionDistance').value) && 
                                parseFloat(document.getElementById('slimeMode').value) > 0) {
                                this.connections.push({
                                    target: other,
                                    distance: distance,
                                    strength: parseFloat(document.getElementById('connectionStrength').value)
                                });
                            }
                        }
                        // ä¸åŒé¢œè‰²çš„ç²’å­ï¼šæ’æ–¥
                        else {
                            totalDifferentColor++;
                            
                            // åº”ç”¨æ’æ–¥åŠ›ï¼Œè·ç¦»è¶Šè¿‘æ’æ–¥åŠ›è¶Šå¼º
                            if (distance < this.perceptionRadius / 1.5) {
                                separation.x += (dx / distance) * this.repulsionFactor;
                                separation.y += (dy / distance) * this.repulsionFactor;
                            }
                        }
                    }
                }
                
                // è®¡ç®—å¹³å‡ä½ç½®å¹¶åº”ç”¨å¸å¼•åŠ›
                if (totalSameColor > 0) {
                    cohesion.x /= totalSameColor;
                    cohesion.y /= totalSameColor;
                    
                    // ä»å½“å‰ä½ç½®æŒ‡å‘å¹³å‡ä½ç½®çš„å‘é‡
                    cohesion.x = cohesion.x - this.position.x;
                    cohesion.y = cohesion.y - this.position.y;
                    
                    // å½’ä¸€åŒ–å¹¶ä¹˜ä»¥å¸å¼•åŠ›å› å­
                    let dist = Math.sqrt(cohesion.x * cohesion.x + cohesion.y * cohesion.y);
                    if (dist > 0) {
                        cohesion.x = (cohesion.x / dist) * this.cohesionFactor;
                        cohesion.y = (cohesion.y / dist) * this.cohesionFactor;
                    }
                }
                
                // åº”ç”¨åˆ†ç¦»åŠ›
                separation.x *= this.separationFactor;
                separation.y *= this.separationFactor;
                
                // æ–‡å­—æˆå‹å¸å¼•åŠ›
                let textAttractionForce = { x: 0, y: 0 };
                if (this.textTarget && parseFloat(document.getElementById('textAttraction').value) > 0) {
                    let tx = this.textTarget.x - this.position.x;
                    let ty = this.textTarget.y - this.position.y;
                    let tDist = Math.sqrt(tx * tx + ty * ty);
                    
                    if (tDist > 0) {
                        textAttractionForce.x = (tx / tDist) * parseFloat(document.getElementById('textAttraction').value);
                        textAttractionForce.y = (ty / tDist) * parseFloat(document.getElementById('textAttraction').value);
                        
                        // æ·»åŠ ä¸€äº›éšæœºæ€§ï¼Œä½¿æ–‡å­—å½¢çŠ¶ä¸é‚£ä¹ˆå®Œç¾
                        textAttractionForce.x += (Math.random() - 0.5) * 0.3;
                        textAttractionForce.y += (Math.random() - 0.5) * 0.3;
                    }
                }
                
                // æ›´æ–°åŠ é€Ÿåº¦
                this.acceleration.x = cohesion.x + separation.x + textAttractionForce.x;
                this.acceleration.y = cohesion.y + separation.y + textAttractionForce.y;
                
                // åº”ç”¨é»èŒè¿æ¥åŠ›
                if (this.connections.length > 0) {
                    let connectionForce = { x: 0, y: 0 };
                    for (let conn of this.connections) {
                        let dx = conn.target.position.x - this.position.x;
                        let dy = conn.target.position.y - this.position.y;
                        let dist = Math.sqrt(dx * dx + dy * dy);
                        
                        if (dist > 0) {
                            // è¿æ¥åŠ›ä½¿ç²’å­ä¿æŒåœ¨ä¸€å®šè·ç¦»
                            let targetDist = parseFloat(document.getElementById('connectionDistance').value) * 0.7;
                            let force = (dist - targetDist) * conn.strength * 0.01;
                            
                            connectionForce.x += (dx / dist) * force;
                            connectionForce.y += (dy / dist) * force;
                        }
                    }
                    
                    this.acceleration.x += connectionForce.x;
                    this.acceleration.y += connectionForce.y;
                }
            }
            
            // åº”ç”¨é¼ æ ‡å½±å“
            applyMouseForce(mouseX, mouseY, mouseMode, mouseRadius, mouseStrength) {
                if (mouseX === null || mouseY === null) return;
                
                let dx = mouseX - this.position.x;
                let dy = mouseY - this.position.y;
                let distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < mouseRadius) {
                    let force = (1 - distance / mouseRadius) * mouseStrength;
                    
                    if (mouseMode === 'attract') {
                        // å¸å¼•ï¼šæœå‘é¼ æ ‡
                        this.acceleration.x += (dx / distance) * force * 0.5;
                        this.acceleration.y += (dy / distance) * force * 0.5;
                    } else if (mouseMode === 'repel') {
                        // æ’æ–¥ï¼šè¿œç¦»é¼ æ ‡
                        this.acceleration.x -= (dx / distance) * force;
                        this.acceleration.y -= (dy / distance) * force;
                    } else if (mouseMode === 'food') {
                        // é£Ÿç‰©ï¼šå¢åŠ ç”Ÿå‘½å€¼å¹¶å‘é£Ÿç‰©ç§»åŠ¨
                        this.health = Math.min(1.0, this.health + 0.01);
                        this.acceleration.x += (dx / distance) * force * 0.3;
                        this.acceleration.y += (dy / distance) * force * 0.3;
                    } else if (mouseMode === 'kill') {
                        // æ¸…é™¤ï¼šå‡å°‘ç”Ÿå‘½å€¼
                        this.health -= 0.05;
                        if (this.health <= 0) {
                            this.health = 0;
                        }
                    }
                }
            }
            
            // æ›´æ–°ä½ç½®å’Œé€Ÿåº¦
            update() {
                // æ›´æ–°é€Ÿåº¦
                this.velocity.x += this.acceleration.x;
                this.velocity.y += this.acceleration.y;
                
                // é™åˆ¶æœ€å¤§é€Ÿåº¦
                let speed = Math.sqrt(this.velocity.x * this.velocity.x + this.velocity.y * this.velocity.y);
                if (speed > this.maxSpeed) {
                    this.velocity.x = (this.velocity.x / speed) * this.maxSpeed;
                    this.velocity.y = (this.velocity.y / speed) * this.maxSpeed;
                }
                
                // æ›´æ–°ä½ç½®
                this.position.x += this.velocity.x;
                this.position.y += this.velocity.y;
                
                // è¾¹ç•Œå¤„ç†
                let boundaryBounce = parseFloat(document.getElementById('boundaryBounce').value);
                if (this.position.x < this.radius) {
                    this.velocity.x *= -boundaryBounce;
                    this.position.x = this.radius;
                }
                if (this.position.x > canvas.width - this.radius) {
                    this.velocity.x *= -boundaryBounce;
                    this.position.x = canvas.width - this.radius;
                }
                if (this.position.y < this.radius) {
                    this.velocity.y *= -boundaryBounce;
                    this.position.y = this.radius;
                }
                if (this.position.y > canvas.height - this.radius) {
                    this.velocity.y *= -boundaryBounce;
                    this.position.y = canvas.height - this.radius;
                }
                
                // æ›´æ–°å¹´é¾„å’Œç”Ÿå‘½å€¼
                this.age++;
                this.health -= 0.0001; // è‡ªç„¶è¡°å‡
                
                // å¦‚æœç”Ÿå‘½å€¼è¿‡ä½æˆ–å¹´é¾„è¿‡å¤§ï¼Œæ ‡è®°ä¸ºæ­»äº¡
                if (this.health <= 0 || this.age > this.maxLifespan) {
                    this.health = 0;
                }
                
                // é‡ç½®åŠ é€Ÿåº¦
                this.acceleration.x = 0;
                this.acceleration.y = 0;
            }
            
            // ç»˜åˆ¶ç²’å­
            draw() {
                // æ ¹æ®ç”Ÿå‘½å€¼è°ƒæ•´é€æ˜åº¦
                let alpha = this.health;
                
                // ç»˜åˆ¶è¿æ¥çº¿ï¼ˆé»èŒæ¨¡å¼ï¼‰
                if (this.connections.length > 0 && parseFloat(document.getElementById('slimeMode').value) > 0) {
                    for (let conn of this.connections) {
                        ctx.beginPath();
                        ctx.moveTo(this.position.x, this.position.y);
                        ctx.lineTo(conn.target.position.x, conn.target.position.y);
                        
                        // æ ¹æ®è·ç¦»å’Œå¼ºåº¦è®¾ç½®çº¿æ¡æ ·å¼
                        let lineAlpha = 0.3 * conn.strength * (1 - conn.distance / parseFloat(document.getElementById('connectionDistance').value));
                        ctx.strokeStyle = `rgba(255, 255, 255, ${lineAlpha})`;
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    }
                }
                
                // ç»˜åˆ¶ç²’å­ä¸»ä½“
                ctx.beginPath();
                ctx.arc(this.position.x, this.position.y, this.radius, 0, Math.PI * 2);
                
                // å¡«å……é¢œè‰²
                ctx.fillStyle = this.color.fill;
                ctx.fill();
                
                // ç»˜åˆ¶è¾¹æ¡†
                ctx.beginPath();
                ctx.arc(this.position.x, this.position.y, this.radius, 0, Math.PI * 2);
                ctx.strokeStyle = this.color.stroke;
                ctx.lineWidth = 1;
                ctx.stroke();
                
                // æ ¹æ®ç”Ÿå‘½å€¼ç»˜åˆ¶å†…éƒ¨çŠ¶æ€
                if (this.health < 0.7) {
                    ctx.beginPath();
                    ctx.arc(this.position.x, this.position.y, this.radius * 0.5, 0, Math.PI * 2);
                    ctx.fillStyle = this.health < 0.3 ? '#ffffff' : '#ffcccc';
                    ctx.fill();
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦åº”è¯¥åˆ†è£‚
            shouldSplit() {
                if (this.health < 0.8) return false;
                
                let splitChance = parseFloat(document.getElementById('splitChance').value) / 100;
                return Math.random() < splitChance;
            }
            
            // æ£€æŸ¥æ˜¯å¦åº”è¯¥æ­»äº¡
            shouldDie() {
                if (this.health <= 0) return true;
                
                let deathChance = parseFloat(document.getElementById('deathChance').value) / 100;
                return Math.random() < deathChance;
            }
            
            // åˆ†è£‚ç²’å­
            split() {
                let child = new Particle(
                    this.position.x + (Math.random() - 0.5) * 10,
                    this.position.y + (Math.random() - 0.5) * 10,
                    this.colorType
                );
                
                // ç»§æ‰¿éƒ¨åˆ†å±æ€§
                child.velocity.x = this.velocity.x + (Math.random() - 0.5) * 2;
                child.velocity.y = this.velocity.y + (Math.random() - 0.5) * 2;
                child.health = 0.8;
                child.age = 0;
                
                // å¦‚æœçˆ¶ç²’å­æœ‰æ–‡å­—ç›®æ ‡ï¼Œå­ç²’å­ä¹Ÿç»§æ‰¿
                if (this.textTarget) {
                    child.textTarget = { ...this.textTarget };
                }
                
                return child;
            }
        }

        // æ–‡å­—æˆå‹ç³»ç»Ÿ
        class TextFormation {
            constructor() {
                this.text = "";
                this.points = [];
                this.active = false;
            }
            
            // ç”Ÿæˆæ–‡å­—ç‚¹é˜µ
            generateText(text) {
                this.text = text;
                this.points = [];
                
                // æ¸…ç©ºCanvaså¹¶ç»˜åˆ¶æ–‡å­—ä»¥è·å–åƒç´ æ•°æ®
                let offscreenCanvas = document.createElement('canvas');
                offscreenCanvas.width = canvas.width;
                offscreenCanvas.height = canvas.height;
                let offscreenCtx = offscreenCanvas.getContext('2d');
                
                // ç»˜åˆ¶èƒŒæ™¯
                offscreenCtx.fillStyle = '#000000';
                offscreenCtx.fillRect(0, 0, offscreenCanvas.width, offscreenCanvas.height);
                
                // ç»˜åˆ¶æ–‡å­—
                offscreenCtx.font = 'bold 120px Arial';
                offscreenCtx.fillStyle = '#ffffff';
                offscreenCtx.textAlign = 'center';
                offscreenCtx.textBaseline = 'middle';
                offscreenCtx.fillText(text, offscreenCanvas.width / 2, offscreenCanvas.height / 2);
                
                // è·å–åƒç´ æ•°æ®
                let imageData = offscreenCtx.getImageData(0, 0, offscreenCanvas.width, offscreenCanvas.height);
                let data = imageData.data;
                
                // é‡‡æ ·ç‚¹é˜µ
                let stride = 4; // é‡‡æ ·æ­¥é•¿ï¼Œæ§åˆ¶ç‚¹å¯†åº¦
                for (let y = 0; y < offscreenCanvas.height; y += stride) {
                    for (let x = 0; x < offscreenCanvas.width; x += stride) {
                        let index = (y * offscreenCanvas.width + x) * 4;
                        
                        // å¦‚æœåƒç´ æ˜¯ç™½è‰²ï¼ˆæ–‡å­—éƒ¨åˆ†ï¼‰
                        if (data[index] > 200 && data[index + 1] > 200 && data[index + 2] > 200) {
                            this.points.push({ x, y });
                        }
                    }
                }
                
                // å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„ç‚¹ï¼Œæ·»åŠ ä¸€äº›éšæœºç‚¹
                if (this.points.length < 100) {
                    for (let i = 0; i < 100; i++) {
                        this.points.push({
                            x: Math.random() * offscreenCanvas.width,
                            y: Math.random() * offscreenCanvas.height
                        });
                    }
                }
                
                this.active = true;
                return this.points;
            }
            
            // ä¸ºç²’å­åˆ†é…æœ€è¿‘çš„ç›®æ ‡ç‚¹
            assignTargets(particles) {
                if (!this.active || this.points.length === 0) return;
                
                // æ‰“ä¹±ç‚¹é˜µé¡ºåºä»¥ç¡®ä¿å‡åŒ€åˆ†é…
                let shuffledPoints = [...this.points].sort(() => Math.random() - 0.5);
                
                // ä¸ºæ¯ä¸ªç²’å­åˆ†é…ä¸€ä¸ªç›®æ ‡ç‚¹
                for (let i = 0; i < Math.min(particles.length, shuffledPoints.length); i++) {
                    particles[i].textTarget = shuffledPoints[i];
                }
            }
            
            // ç»˜åˆ¶æ–‡å­—è½®å»“ï¼ˆè°ƒè¯•ç”¨ï¼‰
            draw() {
                if (!this.active || this.points.length === 0) return;
                
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                for (let point of this.points) {
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // æ¸…é™¤æ–‡å­—ç›®æ ‡
            clear() {
                this.active = false;
                this.points = [];
            }
        }

        // åˆå§‹åŒ–å˜é‡
        let particles = [];
        let animationId;
        let mouseX = null;
        let mouseY = null;
        let mouseMode = 'attract';
        let stats = {
            splits: 0,
            deaths: 0,
            connections: 0,
            lastFrameTime: 0,
            fps: 60
        };
        
        // æ–‡å­—æˆå‹ç³»ç»Ÿ
        const textFormation = new TextFormation();

        // åˆå§‹åŒ–æ¨¡æ‹Ÿ
        function initSimulation() {
            // æ¸…é™¤ç°æœ‰ç²’å­
            particles = [];
            
            // è·å–å„ç¾¤ä½“æ•°é‡
            const redCount = parseInt(document.getElementById('redCount').value);
            const greenCount = parseInt(document.getElementById('greenCount').value);
            const blueCount = parseInt(document.getElementById('blueCount').value);
            const yellowCount = parseInt(document.getElementById('yellowCount').value);
            const purpleCount = parseInt(document.getElementById('purpleCount').value);
            const cyanCount = parseInt(document.getElementById('cyanCount').value);
            
            // åˆ›å»ºç²’å­
            createParticlesByColor(0, redCount);    // çº¢è‰²
            createParticlesByColor(1, greenCount);  // ç»¿è‰²
            createParticlesByColor(2, blueCount);   // è“è‰²
            createParticlesByColor(3, yellowCount); // é»„è‰²
            createParticlesByColor(4, purpleCount); // ç´«è‰²
            createParticlesByColor(5, cyanCount);   // é’è‰²
            
            // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
            updateStats();
            
            // å¦‚æœæ–‡å­—æˆå‹ç³»ç»Ÿæ˜¯æ´»åŠ¨çš„ï¼Œé‡æ–°åˆ†é…ç›®æ ‡
            if (textFormation.active) {
                textFormation.assignTargets(particles);
            }
        }
        
        // åˆ›å»ºæŒ‡å®šé¢œè‰²çš„ç²’å­
        function createParticlesByColor(colorType, count) {
            for (let i = 0; i < count; i++) {
                particles.push(new Particle(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height,
                    colorType
                ));
            }
        }
        
        // æ›´æ–°æ‰€æœ‰ç²’å­å‚æ•°
        function updateAllParticlesParameters() {
            for (let particle of particles) {
                particle.updateParameters();
            }
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate(currentTime) {
            // è®¡ç®—FPS
            if (stats.lastFrameTime) {
                let delta = currentTime - stats.lastFrameTime;
                stats.fps = Math.round(1000 / delta);
            }
            stats.lastFrameTime = currentTime;
            
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶èƒŒæ™¯
            drawBackground();
            
            // é‡ç½®è¿æ¥ç»Ÿè®¡
            stats.connections = 0;
            
            // åº”ç”¨é¼ æ ‡å½±å“
            let mouseRadius = parseFloat(document.getElementById('mouseRadius').value);
            let mouseStrength = parseFloat(document.getElementById('mouseStrength').value);
            
            // æ›´æ–°å¹¶ç»˜åˆ¶æ‰€æœ‰ç²’å­
            let newParticles = [];
            let deadParticles = [];
            
            for (let i = 0; i < particles.length; i++) {
                let particle = particles[i];
                
                // åº”ç”¨é¼ æ ‡å½±å“
                particle.applyMouseForce(mouseX, mouseY, mouseMode, mouseRadius, mouseStrength);
                
                // è®¡ç®—ç¾¤ä½“è¡Œä¸º
                particle.flock(particles);
                
                // æ›´æ–°ç²’å­
                particle.update();
                
                // æ£€æŸ¥æ˜¯å¦åº”è¯¥åˆ†è£‚
                if (particle.shouldSplit()) {
                    let child = particle.split();
                    newParticles.push(child);
                    
                    // çˆ¶ç²’å­å‡å°‘ç”Ÿå‘½å€¼
                    particle.health *= 0.7;
                    stats.splits++;
                }
                
                // æ£€æŸ¥æ˜¯å¦åº”è¯¥æ­»äº¡
                if (particle.shouldDie()) {
                    deadParticles.push(i);
                    stats.deaths++;
                } else {
                    // ç»˜åˆ¶å­˜æ´»çš„ç²’å­
                    particle.draw();
                    
                    // ç»Ÿè®¡è¿æ¥æ•°
                    stats.connections += particle.connections.length;
                }
            }
            
            // ç§»é™¤æ­»äº¡çš„ç²’å­
            for (let i = deadParticles.length - 1; i >= 0; i--) {
                particles.splice(deadParticles[i], 1);
            }
            
            // æ·»åŠ æ–°ç²’å­
            particles.push(...newParticles);
            
            // ç»˜åˆ¶æ–‡å­—è½®å»“ï¼ˆè°ƒè¯•ï¼‰
            textFormation.draw();
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats();
            
            // ç»§ç»­åŠ¨ç”»å¾ªç¯
            animationId = requestAnimationFrame(animate);
        }
        
        // ç»˜åˆ¶èƒŒæ™¯
        function drawBackground() {
            // æ¸å˜èƒŒæ™¯
            let gradient = ctx.createRadialGradient(
                canvas.width / 2, canvas.height / 2, 0,
                canvas.width / 2, canvas.height / 2, Math.max(canvas.width, canvas.height) / 2
            );
            gradient.addColorStop(0, 'rgba(10, 10, 10, 0.1)');
            gradient.addColorStop(1, 'rgba(26, 26, 46, 0.3)');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç½‘æ ¼
            ctx.strokeStyle = 'rgba(100, 116, 139, 0.05)';
            ctx.lineWidth = 1;
            
            // å‚ç›´çº¿
            for (let x = 0; x < canvas.width; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // æ°´å¹³çº¿
            for (let y = 0; y < canvas.height; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }
        
        // æ›´æ–°æ•°å€¼æ˜¾ç¤º
        function updateValueDisplays() {
            // ç¾¤ä½“æ•°é‡
            document.getElementById('redCountValue').textContent = 
                document.getElementById('redCount').value;
            document.getElementById('greenCountValue').textContent = 
                document.getElementById('greenCount').value;
            document.getElementById('blueCountValue').textContent = 
                document.getElementById('blueCount').value;
            document.getElementById('yellowCountValue').textContent = 
                document.getElementById('yellowCount').value;
            document.getElementById('purpleCountValue').textContent = 
                document.getElementById('purpleCount').value;
            document.getElementById('cyanCountValue').textContent = 
                document.getElementById('cyanCount').value;
            
            // å…¨å±€å‚æ•°
            document.getElementById('maxSpeedValue').textContent = 
                parseFloat(document.getElementById('maxSpeed').value).toFixed(1);
            document.getElementById('perceptionRadiusValue').textContent = 
                document.getElementById('perceptionRadius').value;
            document.getElementById('boundaryBounceValue').textContent = 
                parseFloat(document.getElementById('boundaryBounce').value).toFixed(1);
            
            // ç»†èŒè¡Œä¸º
            document.getElementById('splitChanceValue').textContent = 
                parseFloat(document.getElementById('splitChance').value).toFixed(1) + '%';
            document.getElementById('deathChanceValue').textContent = 
                parseFloat(document.getElementById('deathChance').value).toFixed(1) + '%';
            document.getElementById('maxLifespanValue').textContent = 
                document.getElementById('maxLifespan').value;
            
            // é»èŒæ¨¡æ‹Ÿ
            document.getElementById('slimeModeValue').textContent = 
                parseFloat(document.getElementById('slimeMode').value).toFixed(0) + '%';
            document.getElementById('connectionDistanceValue').textContent = 
                document.getElementById('connectionDistance').value;
            document.getElementById('connectionStrengthValue').textContent = 
                parseFloat(document.getElementById('connectionStrength').value).toFixed(1);
            
            // é¼ æ ‡æ§åˆ¶
            document.getElementById('mouseRadiusValue').textContent = 
                document.getElementById('mouseRadius').value;
            document.getElementById('mouseStrengthValue').textContent = 
                parseFloat(document.getElementById('mouseStrength').value).toFixed(1);
            
            // æ–‡å­—æˆå‹
            document.getElementById('textAttractionValue').textContent = 
                parseFloat(document.getElementById('textAttraction').value).toFixed(1);
            document.getElementById('textRetentionValue').textContent = 
                parseFloat(document.getElementById('textRetention').value).toFixed(1);
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('totalParticles').textContent = particles.length;
            document.getElementById('fpsCounter').textContent = stats.fps;
            document.getElementById('connectionsCount').textContent = Math.floor(stats.connections / 2); // æ¯ä¸ªè¿æ¥è¢«è®¡ç®—ä¸¤æ¬¡
            document.getElementById('splitCount').textContent = stats.splits;
            document.getElementById('deathCount').textContent = stats.deaths;
            
            let slimeValue = parseFloat(document.getElementById('slimeMode').value);
            document.getElementById('slimeActive').textContent = slimeValue > 0 ? 'å¼€' : 'å…³';
        }
        
        // é‡ç½®å‚æ•°åˆ°é»˜è®¤å€¼
        function resetParameters() {
            // ç¾¤ä½“æ•°é‡
            document.getElementById('redCount').value = 50;
            document.getElementById('greenCount').value = 50;
            document.getElementById('blueCount').value = 50;
            document.getElementById('yellowCount').value = 50;
            document.getElementById('purpleCount').value = 50;
            document.getElementById('cyanCount').value = 50;
            
            // å…¨å±€å‚æ•°
            document.getElementById('maxSpeed').value = 4;
            document.getElementById('perceptionRadius').value = 80;
            document.getElementById('boundaryBounce').value = 0.8;
            
            // ç»†èŒè¡Œä¸º
            document.getElementById('splitChance').value = 0.5;
            document.getElementById('deathChance').value = 0.2;
            document.getElementById('maxLifespan').value = 800;
            
            // é»èŒæ¨¡æ‹Ÿ
            document.getElementById('slimeMode').value = 0;
            document.getElementById('connectionDistance').value = 40;
            document.getElementById('connectionStrength').value = 0.3;
            
            // é¼ æ ‡æ§åˆ¶
            document.getElementById('mouseRadius').value = 100;
            document.getElementById('mouseStrength').value = 2;
            
            // æ–‡å­—æˆå‹
            document.getElementById('textAttraction').value = 0.8;
            document.getElementById('textRetention').value = 0.5;
            document.getElementById('textInput').value = "Boids";
            
            updateValueDisplays();
            updateAllParticlesParameters();
            initSimulation();
            stats.splits = 0;
            stats.deaths = 0;
        }
        
        // éšæœºåŒ–å‚æ•°
        function randomizeParameters() {
            // ç¾¤ä½“æ•°é‡
            document.getElementById('redCount').value = Math.floor(Math.random() * 150) + 30;
            document.getElementById('greenCount').value = Math.floor(Math.random() * 150) + 30;
            document.getElementById('blueCount').value = Math.floor(Math.random() * 150) + 30;
            document.getElementById('yellowCount').value = Math.floor(Math.random() * 150) + 30;
            document.getElementById('purpleCount').value = Math.floor(Math.random() * 150) + 30;
            document.getElementById('cyanCount').value = Math.floor(Math.random() * 150) + 30;
            
            // å…¨å±€å‚æ•°
            document.getElementById('maxSpeed').value = (Math.random() * 7 + 2).toFixed(1);
            document.getElementById('perceptionRadius').value = Math.floor(Math.random() * 100) + 40;
            document.getElementById('boundaryBounce').value = (Math.random() * 0.7 + 0.3).toFixed(1);
            
            // ç»†èŒè¡Œä¸º
            document.getElementById('splitChance').value = (Math.random() * 3).toFixed(1);
            document.getElementById('deathChance').value = (Math.random() * 2).toFixed(1);
            document.getElementById('maxLifespan').value = Math.floor(Math.random() * 1500) + 300;
            
            // é»èŒæ¨¡æ‹Ÿ
            document.getElementById('slimeMode').value = Math.random() > 0.5 ? 100 : 0;
            document.getElementById('connectionDistance').value = Math.floor(Math.random() * 70) + 20;
            document.getElementById('connectionStrength').value = (Math.random() * 0.7 + 0.1).toFixed(1);
            
            updateValueDisplays();
            updateAllParticlesParameters();
            initSimulation();
        }
        
        // åˆ‡æ¢é»èŒæ¨¡å¼
        function toggleSlimeMode() {
            let currentValue = parseFloat(document.getElementById('slimeMode').value);
            document.getElementById('slimeMode').value = currentValue > 0 ? 0 : 100;
            updateValueDisplays();
        }
        
        // åº”ç”¨æ–‡å­—æˆå‹
        function applyTextFormation() {
            let text = document.getElementById('textInput').value.trim();
            if (text) {
                textFormation.generateText(text);
                textFormation.assignTargets(particles);
            }
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initEventListeners() {
            // ä¸ºæ‰€æœ‰æ»‘å—æ·»åŠ äº‹ä»¶ç›‘å¬
            const sliders = document.querySelectorAll('input[type="range"]');
            sliders.forEach(slider => {
                slider.addEventListener('input', function() {
                    updateValueDisplays();
                    
                    // å¦‚æœæ˜¯ç¾¤ä½“æ•°é‡æ»‘å—ï¼Œé‡æ–°åˆå§‹åŒ–æ¨¡æ‹Ÿ
                    if (this.id.includes('Count')) {
                        initSimulation();
                    } else {
                        // å¦åˆ™åªæ›´æ–°å‚æ•°
                        updateAllParticlesParameters();
                    }
                });
            });
            
            // é¼ æ ‡ç§»åŠ¨äº‹ä»¶
            canvas.addEventListener('mousemove', function(event) {
                const rect = canvas.getBoundingClientRect();
                mouseX = event.clientX - rect.left;
                mouseY = event.clientY - rect.top;
            });
            
            canvas.addEventListener('mouseleave', function() {
                mouseX = null;
                mouseY = null;
            });
            
            // é¼ æ ‡æ¨¡å¼é€‰æ‹©
            document.querySelectorAll('.mouse-mode').forEach(mode => {
                mode.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    document.querySelectorAll('.mouse-mode').forEach(m => {
                        m.classList.remove('active');
                    });
                    
                    // æ·»åŠ activeç±»åˆ°å½“å‰æ¨¡å¼
                    this.classList.add('active');
                    
                    // æ›´æ–°é¼ æ ‡æ¨¡å¼
                    mouseMode = this.getAttribute('data-mode');
                    document.getElementById('currentMouseMode').textContent = 
                        this.querySelector('div').textContent;
                });
            });
            
            // é‡ç½®æŒ‰é’®
            document.getElementById('resetBtn').addEventListener('click', resetParameters);
            
            // éšæœºåŒ–æŒ‰é’®
            document.getElementById('randomizeBtn').addEventListener('click', randomizeParameters);
            
            // é»èŒæ¨¡å¼æŒ‰é’®
            document.getElementById('toggleSlimeBtn').addEventListener('click', toggleSlimeMode);
            
            // æ–‡å­—æˆå‹æŒ‰é’®
            document.getElementById('textFormBtn').addEventListener('click', applyTextFormation);
            
            // æ–‡å­—è¾“å…¥æ¡†å›è½¦äº‹ä»¶
            document.getElementById('textInput').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    applyTextFormation();
                }
            });
            
            // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´canvaså¤§å°
            window.addEventListener('resize', function() {
                // ä¿æŒcanvasçš„å®½é«˜æ¯”ä¾‹
                const container = document.querySelector('.canvas-container');
                canvas.width = container.clientWidth;
                canvas.height = Math.min(container.clientWidth * 0.7, 700);
                
                // å¦‚æœæ–‡å­—æˆå‹ç³»ç»Ÿæ˜¯æ´»åŠ¨çš„ï¼Œé‡æ–°ç”Ÿæˆ
                if (textFormation.active) {
                    textFormation.generateText(textFormation.text);
                    textFormation.assignTargets(particles);
                }
            });
        }
        
        // å¯åŠ¨æ¨¡æ‹Ÿ
        function startSimulation() {
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
            initEventListeners();
            
            // åˆå§‹åŒ–æ•°å€¼æ˜¾ç¤º
            updateValueDisplays();
            
            // åˆå§‹åŒ–ç²’å­
            initSimulation();
            
            // åˆå§‹æ–‡å­—æˆå‹
            applyTextFormation();
            
            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            animationId = requestAnimationFrame(animate);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨æ¨¡æ‹Ÿ
        window.addEventListener('load', startSimulation);
    </script>
</body>
</html>